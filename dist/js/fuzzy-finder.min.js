/**
 * @license almond 0.3.1 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.slice(0,v.length-1).concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){var i=l.call(arguments,0);return typeof i[0]!="string"&&i.length===1&&i.push(null),n.apply(e,i.concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){if(typeof e!="string")throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("lib/almond-0.3.1",function(){}),define("fuzzy-finder/model",[],function(){function e(e,t){if(e.length===0)return t.length;if(t.length===0)return e.length;var n,r,i,s,o=[];i=e.length,s=t.length;for(n=0;n<=s;n++)o[n]=[n];for(r=0;r<=i;r++)o[0][r]=r;for(n=1;n<=s;n++)for(r=1;r<=i;r++)t.charAt(n-1)===e.charAt(r-1)?o[n][r]=o[n-1][r-1]:o[n][r]=Math.min(o[n-1][r-1]+1,Math.min(o[n][r-1]+1,o[n-1][r]+1));return o[s][i]}function t(e,t){return t.some(function(t){return e.uid===t.uid})}function n(e){var t="",n;for(n in e)t+=n+":"+(!e[n]||typeof e[n]!="object"?e[n]:e[n].val)+"^";return t}return{regexSuggestions:function(e,r,i){function f(r){var i=r[s].indexOf(e),a,f;i!==-1?(i=[e],f=1):o&&(i=r[s].match(o));if(!!i&&typeof i[0]=="string"){a=i[0].toLowerCase(),f=f||e.length/a.length;if(f<.5)return;var l={},c,h;if(s==="h")c=r.h,h=c.toLowerCase().indexOf(a),l.t="url",l.h={val:c,match:[h,a.length]};else{var p;for(p in r)c=r[p],s===p?(h=c.toLowerCase().indexOf(a),l[p]={val:c,match:[h,a.length]}):l[p]=r[p]}l.uid=n(l),l.score=f,t(l,u)||u.push(l)}}var s="c";if(e.match(/^url\!/)){s="h",e=e.replace(/^url\!/,"");if(!e.length)return null}var o,u=[];try{o=new RegExp(e.split("").join(".*?"),"mgi")}catch(a){console.warn("malformed query: ",a),o=null}return r.map(function(e){(!i||i.indexOf(e.t)!==-1)&&f(e)}),u.sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:0})},levenstainSuggestions:function(e,t,n){return[]}}}),define("fuzzy-finder/view",[],function(){function e(e,t,n){var r=document.createElement(e);if(!!t&&typeof t=="object")for(var i in t)r[i]!==undefined?r[i]=t[i]:r.setAttribute(i,t[i]);return"textContent"in r!==undefined&&(r.textContent=typeof t=="string"?t:n||""),r}function t(t,n){var r=document.createElement("span");if(typeof t=="string")r=e("span",{className:n},t);else{r=document.createDocumentFragment();var i=t.match[0],s=t.match[1],o=t.val.substr(0,i),u=t.val.substr(i,s),a=t.val.substr(i+s,t.val.length);!o.length||r.appendChild(e("span",{className:n},o)),!u.length||r.appendChild(e("span",{className:"selection"},u)),!a.length||r.appendChild(e("span",{className:n},a))}return r.children?r:null}function n(n){if(typeof n.c=="object"||typeof n.h=="object"){var r=n.t==="url",i=e("li"),s=e("a",{className:"item",href:n.h.val||n.h,target:"_blank","data-info":n.t||""}),o=t(r?n.h:n.c,"content");!o||i.appendChild(s).appendChild(o);if(r===!1){var u=t(n.h,"url");!u||i.appendChild(s).appendChild(u)}return i}return null}function r(e){var t=document.createDocumentFragment();return e.forEach(function(e){var r=n(e);!r||t.appendChild(r)}),t}var i=function(e){this.holderEle=e,this.result=[]};return i.prototype={clearResults:function(){while(this.holderEle.children.length)this.holderEle.children[0].onclick=null,this.holderEle.removeChild(this.holderEle.children[0]);this.holderEle.scrollTop=0,this.result=[],this.selectedItem=null},close:function(){this.selectedItem=null,this.holderEle.className=this.holderEle.className.replace(" active","")},setSelected:function(e){var t=this.holderEle.offsetHeight;this.selectedItem=null,this.result.forEach(function(n,r){if(r===e){this.selectedItem=n;if(this.selectedItem.className.indexOf("hover")===-1){this.selectedItem.className+=" hover";var i=this.selectedItem.offsetTop,s=this.selectedItem.offsetHeight;i+s>t?this.holderEle.scrollTop=i+s-t:this.holderEle.scrollTop=0}}else n.className=n.className.replace(/\shover/gi,"")}.bind(this))},render:function(e){if(!e.length)return;var t=r(e);this.holderEle.appendChild(t),this.result=Array.prototype.slice.call(this.holderEle.getElementsByTagName("li")),!!this.result.length&&this.holderEle.className.indexOf("active")===-1&&(this.holderEle.className+=" active")}},i}),define("fuzzy-finder/results-controller",[],function(){var e=function(e){this.view=e};return e.prototype={reset:function(){this.selectedIndex=-1,this.resultLength=0},refresh:function(){this.resultLength=this.view.result.length,this.selectedIndex=-1},check:function(e){if(e.keyCode===27&&this.view.selectedItem){this.view.setSelected(-1),this.view.holderEle.scrollTop=0,this.refresh(),e.stopImmediatePropagation();return}if(!!e.keyCode&&[38,40].indexOf(e.keyCode)!==-1&&!!this.resultLength){this.selectedIndex+=e.keyCode===38?-1:1,this.selectedIndex=Math.min(this.selectedIndex,this.resultLength-1),this.selectedIndex=Math.max(this.selectedIndex,0),this.view.setSelected(this.selectedIndex),e.stopImmediatePropagation();return}},openSelected:function(){this.view&&this.view.selectedItem&&this.view.selectedItem.getElementsByTagName("a")[0].click()}},e}),define("fuzzy-finder/controller",["fuzzy-finder/model","fuzzy-finder/view","fuzzy-finder/results-controller"],function(e,t,n){var r=function(e,r,i){this.db=i,this.inputEle=e,this.timeout=0,this.view=new t(r),this.nav=new n(this.view),this.bindKeyboard()};return r.prototype={bindKeyboard:function(){this.inputEle.form.addEventListener("submit",this.checkQuery.bind(this),!1),this.inputEle.form.addEventListener("submit",this.nav.openSelected.bind(this.nav),!1),this.inputEle.addEventListener("keyup",this.nav.check.bind(this.nav),!1),this.inputEle.addEventListener("keyup",this.checkQuery.bind(this),!1),this.inputEle.form.addEventListener("focusout",this.closeView.bind(this))},checkQuery:function(e){e.type==="submit"&&e.preventDefault();if(e.keyCode===27&&this.nav.resultLength>0){this.query=null,this.inputEle.value="",this.view.clearResults(),this.closeView();return}if(!!e.keyCode&&[16,18,93,91,18,17].indexOf(e.keyCode)!==-1)return;var t=this.inputEle.value;if(t.length<3){this.closeView();return}if(t===this.query&&!!this.query)return;this.query=this.inputEle.value;var n=this.query.split(":")||[],r=n.pop();clearTimeout(this.timeout),!!r&&r.length>2&&(this.timeout=setTimeout(function(){this.getResult(r,n)}.bind(this),this.resultLength?800:500))},getResult:function(t,n){var r=(new Date).getTime(),i=e.regexSuggestions(t,this.db,n.length?n:null);r=(new Date).getTime()-r;var s=(new Date).getTime();!i||!i.length?(this.nav.reset(),this.closeView()):(this.view.clearResults(),this.view.render(i),this.nav.refresh()),s=(new Date).getTime()-s,this.setQueryStatus("results:"+this.nav.resultLength+"/ query:"+r+"ms/ render:"+s+"ms")},closeView:function(e){clearTimeout(this.timeout),this.nav.reset(),this.query=undefined,this.setQueryStatus(""),this.view.clearResults(),this.view.close()},setQueryStatus:function(e){this.inputEle.form.setAttribute("data-report",e)}},function(e){var t=document.getElementById("fuzzy-query"),n=document.getElementById("fuzzy-result");!t||!n||!e?console.warn("missing dependencies",t,n,e):t.plugin=new r(t,n,e)}});