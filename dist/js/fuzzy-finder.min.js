define("fuzzy-finder/model",[],function(){function e(e,t){if(e.length===0)return t.length;if(t.length===0)return e.length;var n,r,i,s,o=[];i=e.length,s=t.length;for(n=0;n<=s;n++)o[n]=[n];for(r=0;r<=i;r++)o[0][r]=r;for(n=1;n<=s;n++)for(r=1;r<=i;r++)t.charAt(n-1)===e.charAt(r-1)?o[n][r]=o[n-1][r-1]:o[n][r]=Math.min(o[n-1][r-1]+1,Math.min(o[n][r-1]+1,o[n-1][r]+1));return o[s][i]}function t(e,t){return t.some(function(t){return e.uid===t.uid})}function n(e){var t="",n;for(n in e)t+=n+":"+(!e[n]||typeof e[n]!="object"?e[n]:e[n].val)+"^";return t}return{regexSuggestions:function(e,r,i){function f(r){var i=r[s].indexOf(e),a,f;i!==-1?(i=[e],f=1):o&&(i=r[s].match(o));if(!!i&&typeof i[0]=="string"){a=i[0].toLowerCase(),f=f||e.length/a.length;if(f<.5)return;var l={},c,h;if(s==="h")c=r.h,h=c.toLowerCase().indexOf(a),l.t="url",l.h={val:c,match:[h,a.length]};else{var p;for(p in r)c=r[p],s===p?(h=c.toLowerCase().indexOf(a),l[p]={val:c,match:[h,a.length]}):l[p]=r[p]}l.uid=n(l),l.score=f,t(l,u)||u.push(l)}}var s="c";if(e.match(/^url\!/)){s="h",e=e.replace(/^url\!/,"");if(!e.length)return null}var o,u=[];try{o=new RegExp(e.split("").join(".*?"),"mgi")}catch(a){console.warn("malformed query: ",a),o=null}return r.map(function(e){(!i||i.indexOf(e.t)!==-1)&&f(e)}),u.sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:0})},levenstainSuggestions:function(e,t,n){return[]}}}),define("fuzzy-finder/view",[],function(){function e(e,t,n){var r=document.createElement(e);if(!!t&&typeof t=="object")for(var i in t)r[i]!==undefined?r[i]=t[i]:r.setAttribute(i,t[i]);return"textContent"in r!==undefined&&(r.textContent=typeof t=="string"?t:n||""),r}function t(t,n){var r=document.createElement("span");if(typeof t=="string")r=e("span",{className:n},t);else{r=document.createDocumentFragment();var i=t.match[0],s=t.match[1],o=t.val.substr(0,i),u=t.val.substr(i,s),a=t.val.substr(i+s,t.val.length);!o.length||r.appendChild(e("span",{className:n},o)),!u.length||r.appendChild(e("span",{className:"selection"},u)),!a.length||r.appendChild(e("span",{className:n},a))}return r.children?r:null}function n(n){if(typeof n.c=="object"||typeof n.h=="object"){var r=n.t==="url",i=e("li"),s=e("a",{className:"item",href:n.h.val||n.h,target:"_blank","data-info":n.t||""}),o=t(r?n.h:n.c,"content");!o||i.appendChild(s).appendChild(o);if(r===!1){var u=t(n.h,"url");!u||i.appendChild(s).appendChild(u)}return i}return null}function r(e){var t=document.createDocumentFragment();return e.forEach(function(e){var r=n(e);!r||t.appendChild(r)}),t}var i=function(e){this.holderEle=e,this.result=[]};return i.prototype={clearResults:function(){while(this.holderEle.children.length)this.holderEle.children[0].onclick=null,this.holderEle.removeChild(this.holderEle.children[0]);this.holderEle.scrollTop=0,this.result=[],this.selectedItem=null},close:function(){this.selectedItem=null,this.holderEle.className=this.holderEle.className.replace(" active","")},setSelected:function(e){var t=this.holderEle.offsetHeight;this.selectedItem=null,this.result.forEach(function(n,r){if(r===e){this.selectedItem=n;if(this.selectedItem.className.indexOf("hover")===-1){this.selectedItem.className+=" hover";var i=this.selectedItem.offsetTop,s=this.selectedItem.offsetHeight;i+s>t?this.holderEle.scrollTop=i+s-t:this.holderEle.scrollTop=0}}else n.className=n.className.replace(/\shover/gi,"")}.bind(this))},render:function(e){if(!e.length)return;var t=r(e);this.holderEle.appendChild(t),this.result=Array.prototype.slice.call(this.holderEle.getElementsByTagName("li")),!!this.result.length&&this.holderEle.className.indexOf("active")===-1&&(this.holderEle.className+=" active")}},i}),define("fuzzy-finder/results-controller",[],function(){var e=function(e){this.view=e};return e.prototype={reset:function(){this.selectedIndex=-1,this.resultLength=0},refresh:function(){this.resultLength=this.view.result.length,this.selectedIndex=-1},check:function(e){if(e.keyCode===27&&this.view.selectedItem){this.view.setSelected(-1),this.view.holderEle.scrollTop=0,this.refresh(),e.stopImmediatePropagation();return}if(!!e.keyCode&&[38,40].indexOf(e.keyCode)!==-1&&!!this.resultLength){this.selectedIndex+=e.keyCode===38?-1:1,this.selectedIndex=Math.min(this.selectedIndex,this.resultLength-1),this.selectedIndex=Math.max(this.selectedIndex,0),this.view.setSelected(this.selectedIndex),e.stopImmediatePropagation();return}},openSelected:function(){this.view&&this.view.selectedItem&&this.view.selectedItem.getElementsByTagName("a")[0].click()}},e}),define("fuzzy-finder/controller",["fuzzy-finder/model","fuzzy-finder/view","fuzzy-finder/results-controller"],function(e,t,n){var r=function(e,r,i){this.db=i,this.inputEle=e,this.timeout=0,this.view=new t(r),this.nav=new n(this.view),this.bindKeyboard()};return r.prototype={bindKeyboard:function(){this.inputEle.form.addEventListener("submit",this.checkQuery.bind(this),!1),this.inputEle.form.addEventListener("submit",this.nav.openSelected.bind(this.nav),!1),this.inputEle.addEventListener("keyup",this.nav.check.bind(this.nav),!1),this.inputEle.addEventListener("keyup",this.checkQuery.bind(this),!1)},checkQuery:function(e){e.type==="submit"&&e.preventDefault();if(e.keyCode===27&&this.nav.resultLength>0){this.query=null,this.inputEle.value="",this.view.clearResults(),this.closeView();return}if(!!e.keyCode&&[16,18,93,91,18,17].indexOf(e.keyCode)!==-1)return;var t=this.inputEle.value;if(t.length<3){this.closeView();return}if(t===this.query&&!!this.query)return;this.query=this.inputEle.value;var n=this.query.split(":")||[],r=n.pop();clearTimeout(this.timeout),!!r&&r.length>2&&(this.timeout=setTimeout(function(){this.getResult(r,n)}.bind(this),this.resultLength?800:500))},getResult:function(t,n){var r=(new Date).getTime(),i=e.regexSuggestions(t,this.db,n.length?n:null);r=(new Date).getTime()-r;var s=(new Date).getTime();!i||!i.length?(this.nav.reset(),this.closeView()):(this.view.clearResults(),this.view.render(i),this.nav.refresh()),s=(new Date).getTime()-s,this.setQueryStatus("results:"+this.nav.resultLength+"/ query:"+r+"ms/ render:"+s+"ms")},closeView:function(e){clearTimeout(this.timeout),this.nav.reset(),this.query=undefined,this.setQueryStatus(""),this.view.clearResults(),this.view.close()},setQueryStatus:function(e){this.inputEle.form.setAttribute("data-report",e)}},function(e){var t=document.getElementById("fuzzy-query"),n=document.getElementById("fuzzy-result");!t||!n||!e?console.warn("missing dependencies",t,n,e):t.plugin=new r(t,n,e)}});