/**
 * @license almond 0.3.1 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

var requirejs,require,define;!function(e){function t(e,t){return g.call(e,t)}function n(e,t){var n,i,r,s,l,o,u,h,c,a,f,d=t&&t.split("/"),p=m.map,v=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(e=e.split("/"),l=e.length-1,m.nodeIdCompat&&E.test(e[l])&&(e[l]=e[l].replace(E,"")),e=d.slice(0,d.length-1).concat(e),c=0;c<e.length;c+=1)if(f=e[c],"."===f)e.splice(c,1),c-=1;else if(".."===f){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((d||v)&&p){for(n=e.split("/"),c=n.length;c>0;c-=1){if(i=n.slice(0,c).join("/"),d)for(a=d.length;a>0;a-=1)if(r=p[d.slice(0,a).join("/")],r&&(r=r[i])){s=r,o=c;break}if(s)break;!u&&v&&v[i]&&(u=v[i],h=c)}!s&&u&&(s=u,o=h),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function i(t,n){return function(){var i=y.call(arguments,0);return"string"!=typeof i[0]&&1===i.length&&i.push(null),c.apply(e,i.concat([t,n]))}}function r(e){return function(t){return n(t,e)}}function s(e){return function(t){d[e]=t}}function l(n){if(t(p,n)){var i=p[n];delete p[n],v[n]=!0,h.apply(e,i)}if(!t(d,n)&&!t(v,n))throw new Error("No "+n);return d[n]}function o(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function u(e){return function(){return m&&m.config&&m.config[e]||{}}}var h,c,a,f,d={},p={},m={},v={},g=Object.prototype.hasOwnProperty,y=[].slice,E=/\.js$/;a=function(e,t){var i,s=o(e),u=s[0];return e=s[1],u&&(u=n(u,t),i=l(u)),u?e=i&&i.normalize?i.normalize(e,r(t)):n(e,t):(e=n(e,t),s=o(e),u=s[0],e=s[1],u&&(i=l(u))),{f:u?u+"!"+e:e,n:e,pr:u,p:i}},f={require:function(e){return i(e)},exports:function(e){var t=d[e];return"undefined"!=typeof t?t:d[e]={}},module:function(e){return{id:e,uri:"",exports:d[e],config:u(e)}}},h=function(n,r,o,u){var h,c,m,g,y,E,w=[],b=typeof o;if(u=u||n,"undefined"===b||"function"===b){for(r=!r.length&&o.length?["require","exports","module"]:r,y=0;y<r.length;y+=1)if(g=a(r[y],u),c=g.f,"require"===c)w[y]=f.require(n);else if("exports"===c)w[y]=f.exports(n),E=!0;else if("module"===c)h=w[y]=f.module(n);else if(t(d,c)||t(p,c)||t(v,c))w[y]=l(c);else{if(!g.p)throw new Error(n+" missing "+c);g.p.load(g.n,i(u,!0),s(c),{}),w[y]=d[c]}m=o?o.apply(d[n],w):void 0,n&&(h&&h.exports!==e&&h.exports!==d[n]?d[n]=h.exports:m===e&&E||(d[n]=m))}else n&&(d[n]=o)},requirejs=require=c=function(t,n,i,r,s){if("string"==typeof t)return f[t]?f[t](n):l(a(t,n).f);if(!t.splice){if(m=t,m.deps&&c(m.deps,m.callback),!n)return;n.splice?(t=n,n=i,i=null):t=e}return n=n||function(){},"function"==typeof i&&(i=r,r=s),r?h(e,t,n,i):setTimeout(function(){h(e,t,n,i)},4),c},c.config=function(e){return c(e)},requirejs._defined=d,define=function(e,n,i){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");n.splice||(i=n,n=[]),t(d,e)||t(p,e)||(p[e]=[e,n,i])},define.amd={jQuery:!0}}(),define("lib/almond-0.3.1",function(){}),define("hyojun.fuzzy-finder/model",[],function(){function e(e,t){return t.some(function(t){return e.uid===t.uid})}function t(e){var t,n="";for(t in e)n+=t+":"+(e[t]&&"object"==typeof e[t]?e[t].val:e[t])+"^";return n}return{regexSuggestions:function(n,i,r){function s(i){var r,s,h=i[l].indexOf(n);if(-1!==h?(h=[n],s=1):o&&(h=i[l].match(o)),h&&"string"==typeof h[0]){if(r=h[0].toLowerCase(),s=s||n.length/r.length,.3>s)return;var c,a,f={};if("h"===l)c=i.h,a=c.toLowerCase().indexOf(r),f.t=i.t,f.h={val:c,match:[a,r.length]};else{var d;for(d in i)c=i[d],l===d?(a=c.toLowerCase().indexOf(r),f[d]={val:c,match:[a,r.length]}):f[d]=i[d]}f.uid=t(f),f.score=s,e(f,u)||u.push(f)}}var l="c";if(n.match(/^url\!/)&&(l="h",n=n.replace(/^url\!/,""),!n.length))return null;var o,u=[];try{o=new RegExp(n.split("").join(".*?"),"mgi")}catch(h){return console.warn("malformed query: ",h),void(o=null)}return i.map(function(e){r&&-1===r.indexOf(e.t)||s(e)}),u.sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:0})},levenstainSuggestions:function(){return[]}}}),define("hyojun.fuzzy-finder/view",[],function(){function e(e,t,n){var i=document.createElement(e);if(t&&"object"==typeof t)for(var r in t)void 0!==i[r]?i[r]=t[r]:i.setAttribute(r,t[r]);return"textContent"in i!==void 0&&(i.textContent="string"==typeof t?t:n||""),i}function t(t,n){var i=document.createElement("span");if("string"==typeof t)i=e("span",{className:n},t);else{i=document.createDocumentFragment();var r=t.match[0],s=t.match[1],l=t.val.substr(0,r),o=t.val.substr(r,s),u=t.val.substr(r+s,t.val.length);l.length&&i.appendChild(e("span",{className:n},l)),o.length&&i.appendChild(e("span",{className:"selection"},o)),u.length&&i.appendChild(e("span",{className:n},u))}return i}function n(n){if("object"==typeof n.c||"object"==typeof n.h){var i="object"==typeof n.h,r=e("li"),s=e("a",{className:"item",href:n.h.val||n.h,"data-type":n.t||"",target:"_blank"}),l=t(i?n.h:n.c,"content");if(l&&r.appendChild(s).appendChild(l),i===!1){var o=t(n.h,"url");o&&r.appendChild(s).appendChild(o)}return r}return null}function i(e){var t=document.createDocumentFragment();return e.forEach(function(e){var i=n(e);i&&t.appendChild(i)}),t}var r=function(e){this.holderEle=e,this.result=[]};return r.prototype={clearResults:function(){for(;this.holderEle.children.length;)this.holderEle.children[0].onclick=null,this.holderEle.removeChild(this.holderEle.children[0]);this.holderEle.scrollTop=0,this.result=[],this.selectedItem=null},close:function(){this.selectedItem=null,this.holderEle.className=this.holderEle.className.replace(" active","")},setSelected:function(e){var t=this.holderEle.offsetHeight;this.selectedItem=null,this.result.forEach(function(n,i){if(i===e){if(this.selectedItem=n,-1===this.selectedItem.className.indexOf("hover")){this.selectedItem.className+=" hover";var r=this.selectedItem.offsetTop,s=this.selectedItem.offsetHeight;this.holderEle.scrollTop=r+s>t?r+s-t:0}}else n.className=n.className.replace(/\shover/gi,"")}.bind(this))},render:function(e){if(e.length){var t=i(e);this.holderEle.appendChild(t),this.result=Array.prototype.slice.call(this.holderEle.getElementsByTagName("li")),this.result.length&&-1===this.holderEle.className.indexOf("active")&&(this.holderEle.className+=" active")}}},r}),define("hyojun.fuzzy-finder/results-controller",[],function(){var e=function(e){this.view=e};return e.prototype={reset:function(){this.selectedIndex=-1,this.resultLength=0},refresh:function(){this.resultLength=this.view.result.length,this.selectedIndex=-1},check:function(e){return 27===e.keyCode&&this.view.selectedItem?(this.view.setSelected(-1),this.view.holderEle.scrollTop=0,this.refresh(),void e.stopImmediatePropagation()):e.keyCode&&-1!==[38,40].indexOf(e.keyCode)&&this.resultLength?(this.selectedIndex+=38===e.keyCode?-1:1,this.selectedIndex=Math.min(this.selectedIndex,this.resultLength-1),this.selectedIndex=Math.max(this.selectedIndex,0),this.view.setSelected(this.selectedIndex),void e.stopImmediatePropagation()):void 0},openSelected:function(){this.view&&this.view.selectedItem&&this.view.selectedItem.getElementsByTagName("a")[0].click()}},e}),define("hyojun.fuzzy-finder/controller",["hyojun.fuzzy-finder/model","hyojun.fuzzy-finder/view","hyojun.fuzzy-finder/results-controller"],function(e,t,n){var i=function(e,i,r){this.db=r,this.inputEle=e,this.timeout=0,this.view=new t(i),this.nav=new n(this.view),this.bindKeyboard()};return i.prototype={bindKeyboard:function(){this.inputEle.form.addEventListener("submit",this.checkQuery.bind(this),!1),this.inputEle.form.addEventListener("submit",this.nav.openSelected.bind(this.nav),!1),this.inputEle.addEventListener("keyup",this.nav.check.bind(this.nav),!1),this.inputEle.addEventListener("keyup",this.checkQuery.bind(this),!1),this.inputEle.form.addEventListener("focusout",this.closeView.bind(this))},checkQuery:function(e){if("submit"===e.type&&e.preventDefault(),27===e.keyCode&&this.nav.resultLength>0)return this.query=null,this.inputEle.value="",this.view.clearResults(),void this.closeView();if(!e.keyCode||-1===[16,18,93,91,18,17].indexOf(e.keyCode)){var t=this.inputEle.value;if(t.length<3)return void this.closeView();if(t!==this.query||!this.query){this.query=this.inputEle.value;var n=this.query.split(":")||[],i=n.pop();clearTimeout(this.timeout),i&&i.length>2&&(this.timeout=setTimeout(function(){this.getResult(i,n)}.bind(this),this.resultLength?800:500))}}},getResult:function(t,n){var i=(new Date).getTime(),r=e.regexSuggestions(t,this.db,n.length?n:null);i=(new Date).getTime()-i;var s=(new Date).getTime();r&&r.length?(this.view.clearResults(),this.view.render(r),this.nav.refresh()):(this.nav.reset(),this.closeView()),s=(new Date).getTime()-s,this.setQueryStatus("results:"+this.nav.resultLength+"/ query:"+i+"ms/ render:"+s+"ms")},closeView:function(e){return e&&e.currentTarget===this.inputEle.form?void e.preventDefault():(clearTimeout(this.timeout),this.nav.reset(),this.query=void 0,this.setQueryStatus(""),this.view.clearResults(),void this.view.close())},setQueryStatus:function(e){this.inputEle.form.setAttribute("data-report",e)}},function(e){var t=document.getElementById("gl-fuzzy-query"),n=document.getElementById("gl-fuzzy-result");t&&n&&e?t.plugin=new i(t,n,e):console.warn("missing dependencies",t,n,e)}});